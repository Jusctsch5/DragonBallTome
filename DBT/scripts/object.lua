---- Objects classification
define_objects_categorization
{

	{ "CAPSULE",
		{
			"CAPSULE_CAPSULE",
			"CAPSULE_HOUSE",
		},
	},

	{ "POWER_ARMOR",
		{
			"BATTLE_JACKET",
			"HARDSUIT",
		},
	},

	{ "VEHICLE",
		{
			"MOTORCYCLE",
			-- "CAPSULE_HOVERBIKE",
			"CAPSULE_FLYER",
			"CAPSULE_BOAT",
			"CAPSULE_SPACESHIP",
			-- "FREEZA_SPACESHIP",
		},
	},


	{ "POLEARM",
		{
			"SPEAR",
			"BO_STAFF",
			"WAXWOOD_STAFF"
			"THREE_SECTIONAL_STAFF",
			"PUDAO",
		},
	},

	{ "ENTANGLEARM",
		{
			"WHIPCHAIN",
			"ROPE_DART",
		},
	},

	{ "SMALLARM",
		{
			"KUBOTAN",
			"KNIFE",
			"ESCRIMA_STICK",
			"NUNCHAKU",
			"MINI_BUTTERFLY_KNIFE",
			"SAI",
			"TONFA",
			"NINJA_CLAW",
			"SANJOBANG",
			"KAMA",
			"IRON_FAN",
			"HAMMER",
			"TASER",
			"STUN_BATON",
			"CATTLE_PROD",
		}
	},

	{ "SWORDARM",
		{
			"BUTTERFLY_KNIFE",
			"STRAIGHTSWORD",
			"SABRE",
			"WAKAZASHI",
			"SHINAI",
			"BOKKEN",
			"KATANA",
			"TAI_CHI_SWORD",
			"NINJA_TO",
			"HOOK_SWORD",
			"EPEE",
			"RAPIER",
			"JAGGED_SWORD",
			"FIGHTING_UMBRELLA",
			"TWO_HANDED",
			"Z_SWORD",
		},
	},

	{ "GUN",
		{
			"PISTOL",
			"RIFLE",
			"MACHINE_GUN",
		},
	},
	{ "SHOTGUN",
		{
			"SINGLE_SHOTGUN",
			"DOUBLE_SHOTGUN",
		},
	},
	{ "LAUNCHER",
		{
			"BAZOOKA",
		},
	},
	{ "CLIP",
		{
			"STANDARD_ROUNDS"
			"AP_ROUNDS",
		},
	},
	{ "SHOTGUN_ROUND",
		{
			"SCATTERSHOT"
			"LEAD_SLUG",
		},
	},
	{ "MISSILE",
		{
			"STS_MISSILE"
			"INCENDIARY_MISSILE",
		},
	},

	{ "BODY_ARMOUR",
		{
			"BATHROBE",
			"STREETCLOTHES",
			"LIGHTWEIGHT_GI",
			"MEDIUMWEIGHT_GI",
			"HEAVYWEIGHT_GI",
			"SHAOLIN_MONK_ROBES",
			"BOXING_SHORTS",
			"TUTU",
			"QIPAO",
			"TAI_CHI_UNIFORM",
			"TUXEDO",
			"CAMOFLAGUE",
			"NINJA_UNIFORM",
			"DOBAK",
			"SAMURAI_DO",
			"FENCING_ARMOR",
			"FLAK_VEST",
			"FLAK_JACKET",
			"MAWASHI",
			"SPARRING_GEAR",
			"RADIATION_SUIT",
			"EVA_SUIT",
			"SAIYAJIN_ARMOR",
		},
	},

	{ "HEADPIECE",
		{
			"SUNGLASSES",
			"MIRRORED_SHADES",
			"HEADBAND",
			"BLINDFOLD",
			"NINJA_HOOD",
			"SAMURAI_HELM",
			"MOTORCYCLE_HELMET",
			"EARMUFFS",
			"HOCKEY_MASK",
			"INFANTRY_HELMET",
			"GAS_MASK",
			"FENCING_MASK",
		},
	},
	{ "CLOAK",
		{
			"COTTON_CLOAK",
			"CAPE",
			"LEATHER_JACKET",
			"FLIGHT_JACKET",
			"DUSTER",
			"TRENCHCOAT",
			"TURTLE_SHELL",
			"HEAVY_TURTLE_SHELL",
		},
	},
	{ "GLOVES",
		{
			"LIGHT_BOXING_GLOVES",
			"HEAVY_BOXING_GLOVES",
			"GOLFING_GLOVES",
			"SILK_GLOVES",
			"WELDING_GLOVES",
			"SKI_GLOVES",
			"NINJA_CLIMBING_CLAWS",
		},
	},
	{ "BRACERS",
		{
			"WRIST_BRACE",
			"CLOTH_BRACERS",
			"SHAOLIN_FOREARM_WRAPS",
			"LIGHT_LEATHER_BRACERS",
			"HEAVY_LEATHER_BRACERS",
			"STEEL_BRACERS",
			"BATTLE_BRACERS",
			"NINJA_BRACERS",
		},
	},
	{ "SHIELD",
		{
			"LEATHER_SHIELD",
			"RIOT_SHIELD",
		},
	},
	{ "BOOTS",
		{
			"TENNIS_SHOES",
			"LEATHER_BOOTS",
			"FIGHTING_BOOTS",
			"STEEL_TOED_SHOES",
			"LEATHER_THIGH_BOOTS",
			"HIGH_HEELS",
			"NINJA_TABI",
			"NINJA_CLIMBING_TABI",
			"BALLET_SLIPPERS",
			"TOE_SHOES",
			"CROC_BOOTS",
			"INLINE_SKATES",
		},
	},
	{ "TOOL",
		{
			"SHOVEL",
			"PICK",
		},
	},
	{ "BATTERY",
		{
			"BATTERY_BATTERY",
			"BATTERY_FLAME_RETARDANT",
			"BATTERY_OXYGEN_TANK",
			"BATTERY_PROPANE",
			"BATTERY_NAILS",
		},
	},
	{ "LITE",
		{
			"FLASHLIGHT",
			"SAFETY_FLASHLIGHT",
			"MAGLIGHT",
		},
	},
	{ "BRACELET",
		{
			"WATCH",
--			"PULSE_MONITOR",
		},
	},
	{ "JEWELRY",
		{
			"RING",
			"EARING",
		},
	},
	{ "DRINK",
		{
			"BOTTLED_WATER",
			"PERRIER",
			"DR_PEPPER",
			"MOUNTAIN_DEW",
			"JOLT",
			"WINE",
		}
	}
	{ "POTION",
		{
			"POISON",
			"ANTIDOTE",
			"NUCLEAR_WASTE",
		},
	},
	{ "SALVE",
		{
			"COAGULANT",
			"ZHENG_GU_SHUI",
			"BODY_OIL",
		},
	},
	{ "GOLD",
		{

		},
	},
	{ "FOOD",
		{
			"POWER_BAR",
			"BEEF_JERKY",
			"SQUID_JERKY",
			"PIZZA",
			"FORTUNE_COOKIE",
			"PIECE_OF_SUSHI",
			"SENZU_BEAN",
			"CATNIP",
			"CHOCOLATE",
			"LICORICE",
			"GUMMY_BEAR",
			"SOUR_FISH",
			"MRE",
			"COOKED_WHITE_RICE",
			"COOKED_BROWN_RICE",
			"BAG_OF_WHITE_RICE",
			"BAG_OF_BROWN_RICE",
		},
	},
	{ "SUSHI",
		{
			"SUSHI_UNAGI",
			"SUSHI_ANAGO",
			"SUSHI_SABA",
			"SUSHI_TAKKO",
			"SUSHI_FUGU",
		},
	},
	{ "BLUEPRINTS",
		{
			"ANDROID17",
			"EASY_BLUEPRINTS",
			"MEDIUM_BLUEPRINTS",
			"HARD_BLUEPRINTS",
		},
	},
	{ "PARCHMENT",
		{
			"GUIDE",
			"ESSAY_PILOTS_CLUB",
			"ESSAY_BARE_WEAP",
			"ESSAY_COMBAT_MATH",
			"ESSAY_ACUPUNCTURE",
			"WT_GUIDE",
			"WEAPONS_GUIDE",
			"RELEASE_NOTES_024",
			"FIREARMS_GUIDE",
			"RELEASE_NOTES_029",
			"TRANSLATION_COMMENTARY",
			"RECENTLY_DECEASED",
			"RELEASE_NOTES_041",
			"RELEASE_NOTES_050",
			"RELEASE_NOTES_057",
			-- Note: Release 065 had no notes
			"RELEASE_NOTES_066",
			"RELEASE_NOTES_071",
			"RELEASE_NOTES_075",
			"RELEASE_NOTES_076",
			"RELEASE_NOTES_077",
			"RELEASE_NOTES_078",
			"SKILL_EXPERIMENT",
			"RELEASE_NOTES_079",
			"RELEASE_NOTES_080",
			"RELEASE_NOTES_081",
			"RELEASE_NOTES_082",
			"RELEASE_NOTES_083",
			"RELEASE_NOTES_085",
			"README",
			"RELEASE_NOTES_086",
			"RELEASE_NOTES_087",
			"RELEASE_NOTES_088",
			"RELEASE_NOTES_089",
			"RELEASE_NOTES_090",
		},
	},
	{ "JUNK",
		{
			"COMIC_BOOK",
			"MANGA",
			"KUNG_FU_VIDEO",
			"BASEBALL",
			"SOCCER_BALL",
			"UMBRELLA",
			"DOJO_SIGN",
		},
	},
	{ "DBT_BONES",
		{
			"FEMUR",
			"RIBCAGE",
			"SKULL",
		},
	},
	{ "ELECTRONICS",
		{
			"COMPASS",
			"GPS",
			"CELL_PHONE",
			"METAL_DETECTOR",
			"LASER_POINTER",
			"BINOCULARS",
			"SCUBA_GEAR",
			"LAPTOP",
			"RICE_COOKER",
			"MEGAPHONE",
			"ROAD_FLARE",
			"FIRE_EXTINGUISHER",
			"FLAME_THROWER",
			"DRAGON_RADAR",
			"NIGHTVISION_GOGGLES",
			"INFRARED_GOGGLES",
			"BALLISTIC_PLATE",
			"SILENCER",
			"SCOPE",
			"MUSCLE_STIMULATOR",
			"MECHANICAL_TOOLKIT",
			"ELECTRICAL_TOOLKIT",
			"CHEMISTRY_KIT",
			"LATHE",
			"SEWING_KIT",
			"ACUPUNCTURE_NEEDLES",
			"FIRST_AID_KIT",
			"EARPLUGS",
			"MOUTHGUARD",
			"CHAINSAW",
			"BLOWTORCH",
			"JETPACK",
			"SCOUTER",
			"NAILGUN",
			"JACKHAMMER",
			"REMOTE_STOP_DEVICE",
			"TELEVISION_REMOTE",
			"SCISSORS",
		},
	},
	{ "GRENADE",
		{
			"FRAG_GRENADE",
			"INCENDIARY_GRENADE",
			"SMOKE_GRENADE",
			"SHURIKEN",
		},
	},
	{ "CIRCUITRY",
		{
			"RESISTER",
			"CAPACITOR",
			"CIRCUIT_BOARD",
			"SPOOL_OF_WIRE",
			"SPOOL_OF_SOLDER",
			"EPROM",
		},
	},
	{ "CHEMISTRY",
		{
			"IRON",
			"SULPHUR",
			"SODIUM_PERMANGANATE",
			"HYDROGEN_TETRACHLORIDE",
			"ALUMINUM_DIOXIDE",
			"ASSORTED_HYDROCARBONS",
		},
	},
	{ "BULK_MATERIAL",
		{
			"STEEL",
			"ALUMINUM",
			"TITANIUM",
			"PLASTIFORM",
			"FIBERGLASS",
			"TUBING",
		},
	},
	{ "HIGH_TECH_COMPONENTS",
		{
			"PARTICLE_ACCELERATOR",
			"PLASMA_DIODE",
			"MAGLEV_TUBE",
			"CONTAINER_OF_NANITES",
			"TACHYON_STREAMER",
			"POSITRONIC_RELAY",
		},
	},
	{ "DBALL",
		{
			"DRAGONBALL",
		},
	},
	{ "NAMEK_WEAPON",
		{
			"NAM_KNIFE",
		},
	},
	{ "NAMEK_ARMOR",
		{
			"NAM_ROBES",
			"NAM_ELDER_ROBES",
			"NAM_BRACERS",
			"NAM_FIGHTING_BRACERS",
			"NAM_BOOTS",
			"NAM_FIGHTING_BOOTS",
			"NAM_TURBIN",
			"NAM_ELDER_TURBIN",
			"NAM_CAPE",
		},
	},

	-- Misc. Quest items, joke artifacts, thematic misc. stuff, etc.
	{ "MISC",
		{
			"AUTOGRAPH",
			"FAN",
			"CROCK_OF_GOLD",
			"PAIR_OF_PANTIES",
			"RUBY_SLIPPERS",
			"WIDGET",
			"TROPHY",
			"OFUDA",
			"STATUE",
			"NIMBUS",
			"CRYSTAL_BALL",
			"PELT",
			"CLOTH",
			"PAPER_CUP",
			"NAM_AJASA_SEED",
			"NAM_AJASA_PLANT",
			"EARTH_WATER",
			"NAMEK_WATER",
			"SKELETON",
			"VIKING_HELMET",
			"PORNO_MAGAZINE",
			"PLAYTEST",
		},
	},
}
----------------------------------------------------------------------------
-- Ego/arts chance
----------------------------------------------------------------------------
--[[
function rand_obj.get_artifact_chance(obj_level, item_kind)
 	return 1 + rescale(obj_level, 100, 7)
end

function rand_obj.get_single_ego_chance(obj_level, item_kind, ego_info)
	return 3 + rescale(obj_level, 100, 15)
end

function rand_obj.get_double_ego_chance(obj_level, item_kind, ego_info)
	return 0
end
rand_obj.get_artifact_chance = function()
						return 3 + (dun_level / 5)
					end
rand_obj.get_single_ego_chance = function()
						return 5 + (dun_level / 5)
					end
rand_obj.get_double_ego_chance = function()
						return 0
					end
]]
----------------------------------------------------------------------------
-- Flavours
----------------------------------------------------------------------------
function flavour.easy_know(k_idx)
	local item = k_info[k_idx+1]

	-- Analyze the item
	local ok = function() return true end
	local no_norm_art = function(item) return not item.flags[FLAG_NORM_ART] end
	local is_easy_know = function(item) return item.flags[FLAG_EASY_KNOW] end
	local switch =
	{
		[TV_CORPSE] = ok,

		[TV_ELECTRONICS] = no_norm_art,
		[TV_FOOD] = no_norm_art,
		[TV_DRINK] = no_norm_art,
		[TV_POTION] = no_norm_art,
		[TV_SALVE] = no_norm_art,
		[TV_SUSHI] = no_norm_art,
		[TV_BATTERY] = no_norm_art,
		[TV_JUNK] = no_norm_art,
		[TV_CLIP] = no_norm_art,
		[TV_ELECTRONICS] = no_norm_art,
		[TV_CIRCUITRY] = no_norm_art,
		[TV_CHEMISTRY] = no_norm_art,
		[TV_BULK_MATERIAL] = no_norm_art,
		[TV_HIGH_TECH_COMPONENTS] = no_norm_art,
		[TV_BLUEPRINTS] = no_norm_art,
		[TV_PARCHMENT] = no_norm_art,

		[TV_JEWELRY] = is_easy_know,
		[TV_LITE] = is_easy_know,
	}
	if switch[item.tval] then return switch[item.tval](item)
	else return nil
	end
end
----------------------------------------------------------------
-- Object Drop Stuff -------------------------------------------
----------------------------------------------------------------
function objects_on_make_all_pre(obj, power)
--	for i = 1, 2 do
		if rng(1,100) < rand_obj.get_single_ego_chance() then
			local group = "default"
			local ego = rand_obj.get_single_ego(object_level, obj.k_idx, nil, group)
			if ego then
				-- No dougle egos in Dragonball T
				obj.ego_id[1] = ego
				--return
			end
		end
--	end
end

function objects_on_make_all(obj, power)
	if is_artifact(obj) and power < 0 then
		power = 0
	end

	local min_rng, max_rng = 0, 0
	if power < 0 then
		min_rng = power * 5
		max_rng = -1
	elseif power > 0 then
		min_rng = 0
		max_rng = power
	end

	if power~= 0 then
		if obj.tval == TV_SMALLARM or obj.tval == TV_ENTANGLEARM or obj.tval == TV_SWORDARM or obj.tval == TV_POLEARM then
			obj.to_h = obj.to_h + rng(min_rng, max_rng)
			obj.to_d = obj.to_d + rng(min_rng, max_rng)

		elseif obj.tval == TV_GUN or obj.tval == TV_LAUNCHER then
			obj.to_h = obj.to_h + rng(min_rng, max_rng)

		elseif obj.tval == TV_BODY_ARMOUR or obj.tval == TV_BOOTS or obj.tval == TV_HEADPIECE or obj.tval == TV_CLOAK or obj.tval == TV_GLOVES or obj.tval == TV_BRACERS or obj.tval == TV_SHIELD then
			obj.to_a = obj.to_a + rng(min_rng, max_rng)
		end
	end

	-- Id test all non-artifacts
	if not is_artifact(obj) then
		if has_flag(obj, FLAG_ID_SKILL) and has_flag(obj, FLAG_ID_VALUE) then
			if get_skill(obj.flags[FLAG_ID_SKILL]) + player.stat(A_INT) - 10 >= obj.flags[FLAG_ID_VALUE] then
				make_item_fully_identified(obj)
			end
			if dball_data.wish_autoid == 1 then
				make_item_fully_identified(obj)
			end
		end
	end

end

function objects_get_power_level(obj, lev, okay, good, great)
	if lev > 100 then lev = 100 end

	-- Base chance of being "good"
	local f1 = lev + 10

	-- Maximal chance of being "good"
	if f1 > 75 then f1 = 75 end

	-- Base chance of being "great"
	local f2 = f1 / 2

	-- Maximal chance of being "great"
	if f2 > 20 then f2 = 20 end

	-- Assume normal
	local power = 0

	-- Roll for "good"
	if good or rng.percent(f1) then
		-- Assume "good"
		power = 5 + (lev / 5)
		if power < 5 then
			power = 5
		end

		-- Roll for "great"
		if great or rng.percent(f2) then
			power = 10 + (lev / 5)
		end

	-- Roll for "cursed"
	elseif rng.percent(f1) then
		-- Assume "cursed"
		power = -1

		-- Roll for "broken"
		if rng.percent(f2) then power = -2 end
	end
	return power
end
